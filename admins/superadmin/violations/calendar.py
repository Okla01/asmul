"""
calendar_commented.py  โ ะดะธะฐะปะพะณ ะฒัะฑะพัะฐ ะดะฐัั ะฝะฐัััะตะฝะธั ััะฐััะฝะธัั.

ะะพะดัะปั ะธัะฟะพะปัะทัะตั aiogramโdialog (ะฒะธะดะถะตั `Calendar`) ะดะปั ะฟะพะบะฐะทะฐ inlineโะบะฐะปะตะฝะดะฐัั.
ะะตะทัะปััะฐั ะฒัะฑัะฐะฝะฝะพะน ะฟะพะปัะทะพะฒะฐัะตะปะตะผ ะดะฐัั ะฟะตัะตะดะฐัััั ยซะฝะฐััะถัยป ะฒ FSM ัะพะดะธัะตะปััะบะพะณะพ
ัะตะฝะดะปะตัะฐ ัะตัะตะท ะพะฑัะตะบั `FSMContext`, ะบะพัะพััะน ะผั ะบะปะฐะดัะผ ะฒ `DialogManager.start_data`
ะฟัะธ ะพัะบัััะธะธ ะดะธะฐะปะพะณะฐ.

ะัะฝะพะฒะฝะฐั ัะพัะบะฐ ะฒัะพะดะฐ โ ะพะฑัะตะบั `viol_calendar_dialog`, ะบะพัะพััะน ัะพะดะตัะถะธั ะพะดะฝะพ ะพะบะฝะพ
(`Window`) ั ะบะฐะปะตะฝะดะฐััะผ. ะะพัะปะต ะฒัะฑะพัะฐ ะดะฐัั ะฒัะทัะฒะฐะตััั ะบะพะปะฑัะบโััะฝะบัะธั `on_pick`.
"""

from datetime import date
from aiogram.types import CallbackQuery
from aiogram_dialog import Dialog, Window, DialogManager
from aiogram_dialog.widgets.kbd import Calendar
from aiogram_dialog.widgets.text import Const

# --- ะฒะฝัััะตะฝะฝะธะต ะธะผะฟะพััั ะฟัะพะตะบัะฐ ---
from admins.superadmin.violations.states import ViolCal
from aiogram.fsm.context import FSMContext


# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# CALLBACK: ะฟะพะปัะทะพะฒะฐัะตะปั ะฒัะฑัะฐะป ะดะฐัั
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
async def on_pick(
        c: CallbackQuery,
        widget: Calendar,
        manager: DialogManager,
        d: date) -> None:
    """
    ะัะทัะฒะฐะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ, ะบะพะณะดะฐ ะฟะพะปัะทะพะฒะฐัะตะปั ะฝะฐะถะธะผะฐะตั ะฝะฐ ะดะตะฝั ะฒ ะบะฐะปะตะฝะดะฐัะต.

    ะะฐัะฐะผะตััั
    ---------
    c : CallbackQuery
        ะััะพะดะฝัะน callbackโะฐะฟะดะตะนั ะพั Telegram.
    widget : Calendar
        ะญะบะทะตะผะฟะปัั ะบะฐะปะตะฝะดะฐัั, ะบะพัะพััะน ัะณะตะฝะตัะธัะพะฒะฐะป ัะพะฑััะธะต (ะฝะต ะธัะฟะพะปัะทัะตะผ).
    manager : DialogManager
        ะะฑัะตะบัโะผะตะฝะตะดะถะตั ะดะธะฐะปะพะณะฐ, ะฟัะตะดะพััะฐะฒะปัะตั ะดะพัััะฟ ะบ ะดะฐะฝะฝัะผ ะดะธะฐะปะพะณะฐ ะธ ะผะตัะพะดะฐะผ
        ัะฟัะฐะฒะปะตะฝะธั ัััะบะพะผ ะพะบะพะฝ.
    d : date
        ะัะฑัะฐะฝะฝะฐั ะฟะพะปัะทะพะฒะฐัะตะปะตะผ ะดะฐัะฐ.

    ะะตะนััะฒะธั
    --------
    1. ะะพะปััะฐะตะผ ะฒะฝะตัะฝะธะน FSM ัะตัะตะท `manager.start_data` (ะพะฝ ะฑัะป ะฟะตัะตะดะฐะฝ ะฟัะธ
       ะพัะบัััะธะธ ะบะฐะปะตะฝะดะฐัั).
    2. ะกะพััะฐะฝัะตะผ ัััะพะบะพะฒะพะต ะฟัะตะดััะฐะฒะปะตะฝะธะต ะดะฐัั ะฒ ะบะพะฝัะตะบััะต ะฒะฝะตัะฝะตะณะพ FSM.
    3. ะะฐะบััะฒะฐะตะผ ะดะธะฐะปะพะณ ะบะฐะปะตะฝะดะฐัั (`manager.done()`).
    4. ะะพะทะฒัะฐัะฐะตะผ ัะฟัะฐะฒะปะตะฝะธะต ัะพะดะธัะตะปััะบะพะผั ัะตะฝะดะปะตัั โ ะฒัะทัะฒะฐะตะผ `_ask_file`,
       ััะพะฑั ะฟะพะบะฐะทะฐัั ัะปะตะดัััะธะน ัะฐะณ (ยซะฟัะธะบัะตะฟะธัะต ัะฐะนะปโะฟะพะดัะฒะตัะถะดะตะฝะธะตยป).
    """
    # ะฒะฝะตัะฝะธะน FSM ะฟะตัะตะดะฐัะผ ัะตัะตะท data
    vio_fsm: FSMContext = manager.start_data["parent_fsm"]

    # ัะพััะฐะฝัะตะผ ะดะฐัั ะฒ ัะพัะผะฐัะต dd.mm.yyyy
    await vio_fsm.update_data(vdate=d.strftime("%d.%m.%Y"))

    # ะธะผะฟะพัั ะฒะฝัััะธ ััะฝะบัะธะธ, ััะพะฑั ะฝะต ะฒะพะทะฝะธะบ ัะธะบะปะธัะตัะบะฐั ะทะฐะฒะธัะธะผะพััั ะฟัะธ ะธะผะฟะพััะต
    from admins.superadmin.violations.handlers import _ask_file

    # ะทะฐะบััะฒะฐะตะผ ะดะธะฐะปะพะณ ะบะฐะปะตะฝะดะฐัั (ะฒะพะทะฒัะฐั ะบ ัะพะดะธัะตะปััะบะพะผั ัะพะพะฑัะตะฝะธั)
    await manager.done()

    # ะฒัะฒะพะดะธะผ ัะปะตะดัััะธะน ัะฐะณ
    await _ask_file(c, vio_fsm)


# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ะะะะ ะะะะะะะ
# โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
# ะะดะฝะพ ะพะบะฝะพ: ัะตะบััโะทะฐะณะพะปะพะฒะพะบ + ัะฐะผ ะบะฐะปะตะฝะดะฐัั.
win = Window(
    Const("๐ ะัะฑะตัะธัะต <b>ะดะฐัั ะฝะฐัััะตะฝะธั</b>:"),      # ััะฐัะธัะตัะบะธะน ัะตะบัั
    Calendar(id="viol_cal", on_click=on_pick),       # ะฒะธะดะถะตัโะบะฐะปะตะฝะดะฐัั
    state=ViolCal.Pick,                              # ัะพััะพัะฝะธะต FSMโะณััะฟะฟั
    parse_mode="HTML"
)

# ะะฑัะตะบั, ะบะพัะพััะน ะฑัะดะตั ะทะฐะฟััะบะฐัััั ะธะท ะฒะฝะตัะฝะตะณะพ ัะตะฝะดะปะตัะฐ
viol_calendar_dialog = Dialog(win)
